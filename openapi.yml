openapi: '3.1.0'
info:
  title: Oautter
  version: '0.1'
  description: OAuth 2.0 compliant server.
paths:
  /authorize:
    get:
      tags:
        - Authorization
      summary: Endpoint for getting user authorization and start the OAuth 2.0 flow.
      parameters:
        - name: response_type
          in: query
          description: Type of OAuth 2.0 flow between code or token.
          required: true
          schema:
            type: string
            enum: [code, token]
        - name: client_id
          in: query
          description: The unique ID of the client generated by admin.
          required: true
          schema:
            type: string
        - name: redirect_uri
          in: query
          description: The callback URI registed for this client.
          required: true
          schema:
            type: string
        - name: code_challenge
          in: query
          description: BASE64-URL-encoded string of the SHA256 hash of the code verifier. Code verifier is a cryptographically random string using the characters A-Z, a-z, 0-9, and the punctuation characters -._~ (hyphen, period, underscore, and tilde), between 43 and 128 characters long.
          schema:
            type: string
        - name: scope
          in: query
          description: Include one or more scope values (+ separated) to request additional levels of access. Must include 'openid'.
          schema:
            type: string
        - name: state
          in: query
          description: The state parameter serves two functions. When the user is redirected back to your app, whatever value you include as the state will also be included in the redirect. This gives your app a chance to persist data between the user being directed to the authorization server and back again, such as using the state parameter as a session key. This may be used to indicate what action in the app to perform after authorization is complete, for example, indicating which of your appâ€™s pages to redirect to after authorization. The state parameter also serves as a CSRF protection mechanism if it contains a random value per request. When the user is redirected back to your app, double check that the state value matches what you set it to originally.
          schema:
            type: string
      responses:
        '302':
          description: Not OK
        '303':
          description: OK
  /token:
    post:
      tags:
        - Authorization
      summary: Exchange authorization codes and refresh tokens for access tokens.
      requestBody:
        content:
          'application/json':
            schema:
              type: object
              required:
                - grant_type
                - redirect_uri
              properties:
                grant_type:
                  type: string
                  enum: [authorization_code, refresh_token]
                code:
                  type: string
                client_id:
                  type: string
                code_verifier:
                  type: string
                refresh_token:
                  type: string
                redirect_uri:
                  type: string
      responses:
        '200':
          description: OK
          content:
            'application/json':
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  id_token:
                    type: string
                  token_type:
                    type: string
                  expires_in:
                    type: number
        '403':
          description: Incorrect parameters passed.
          content:
            'application/json':
              schema:
                type: object
                properties:
                  error:
                    type: string
      security:
        - client-auth: []
  /introspect:
    post:
      tags:
        - Verification
      summary: Validates if the access, ID or refresh token is active or not.
      requestBody:
        content:
          'application/json':
            schema:
              type: object
              required:
                - token
                - token_type_hint
              properties:
                token:
                  type: string
                token_type_hint:
                  type: string
                  enum: [access_token, id_token, refresh_token]
      responses:
        '200':
          description: Result includes the validity as well as details related to the token.
          content:
            'application/json':
              schema:
                type: object
                properties:
                  active:
                    type: boolean
                  aud:
                    type: string
                  client_id:
                    type: string
                  device_id:
                    type: string
                  exp:
                    type: integer
                  iat:
                    type: integer
                  iss:
                    type: string
                  jti:
                    type: string
                  nbf:
                    type: integer
                  scope:
                    type: string
                  sub:
                    type: string
                  token_type:
                    type: string
                    enum: [Bearer]
                  uid:
                    type: string
                  username:
                    type: string
        '400':
          description: Invalid or malformed request structure.
          content:
            'application/json':
              schema:
                type: object
                properties:
                  error:
                    type: string
      security:
        - client_auth: []
  /revoke:
    post:
      tags:
        - Authorization
      summary: Revokes an access or refresh token.
      requestBody:
        content:
          'application/json':
            schema:
              type: object
              required:
                - token
                - token_type_hint
              properties:
                token:
                  type: string
                token_type_hint:
                  type: string
                  enum: [access_token, refresh_token]
      responses:
        '200':
          description: OK
      security:
        - client_auth: []
  /logout:
    get:
      tags:
        - Logout
      summary: Logout the user.
      parameters:
        - name: id_token_hint
          in: query
          description: The ID matching the current session.
          required: true
          schema:
            type: string
        - name: post_logout_redirect_uri
          in: query
          description: The URL to redirect the user to after logout.
          required: true
          schema:
            type: string
        - name: state
          in: query
          description: Optional value that will be returned as a query param during redirection.
          schema:
            type: string
      responses:
        '302':
          description: OK
  /keys:
    get:
      tags:
        - Verification
      summary: Returns public keys for verifying token signatures in JSON Web Key Set (JWKS).
      responses:
        '200':
          description: List of keys with their properties.
          content:
            'application/json':
              schema:
                type: object
                properties:
                  keys:
                    type: array
                    items:
                      type: object
                      required:
                        - alg
                        - e
                        - kid
                        - kty
                        - "n"
                        - status
                        - use
                      properties:
                        alg:
                          type: string
                          enum: [RS256]
                        e:
                          type: string
                        kid:
                          type: string
                        kty:
                          type: string
                          enum: [RSA]
                        n:
                          type: string
                        status:
                          type: string
                          enum: [ACTIVE, NEXT, EXPIRED]
                        use:
                          type: string
                          enum: [sig]
  /userinfo:
    get:
      tags:
        - User
      summary: Get info about the user to whom the token was issued according to the scope requested.
      responses:
        '200':
          description: OK
          content:
            'application/json':
              schema:
                type: object
                properties:
                  sub:
                    type: string
                  name:
                    type: string
                  given_name:
                    type: string
                  family_name:
                    type: string
                  middle_name:
                    type: string
                  nickname:
                    type: string
                  preferred_username:
                    type: string
                  profile:
                    type: string
                  picture:
                    type: string
                  website:
                    type: string
                  email:
                    type: string
                  email_verified:
                    type: boolean
                  gender:
                    type: string
                  birthdate:
                    type: string
                  zoneinfo:
                    type: string
                  locale:
                    type: string
                  phone_number:
                    type: string
                  phone_number_verified_boolean:
                    type: boolean
                  address:
                    type: object
                    properties:
                      formatted:
                        type: string
                        description: Full mailing address, formatted for display or use on a mailing label. This field MAY contain multiple lines, separated by newlines. Newlines can be represented either as a carriage return/line feed pair ("\r\n") or as a single line feed character ("\n").
                      street_address:
                        type: string
                        description: Full street address component, which MAY include house number, street name, Post Office Box, and multi-line extended street address information. This field MAY contain multiple lines, separated by newlines. Newlines can be represented either as a carriage return/line feed pair ("\r\n") or as a single line feed character ("\n").
                      locality:
                        type: string
                        description: City or locality component.
                      region:
                        type: string
                        description: State, province, prefecture, or region component.
                      postal_code:
                        type: string
                        description: Zip code or postal code component.
                      country:
                        type: string
                        description: Country name component.
                  updated_at:
                    type: number
        '403':
          description: Invalid or no token passed.
      security:
        - user_auth: []
  /.well-known/oauth-authorization-server:
    get:
      tags:
        - Server Metadata
      summary: OAuth 2.0 metadata for the server.
      responses:
        '200':
          description: Success
          content:
            'application/json':
              schema:
                type: object
                properties:
                  issuer:
                    type: string
                  authorization_endpoint:
                    type: string
                  token_endpoint:
                    type: string
                  registration_endpoint:
                    type: string
                  jwks_uri:
                    type: string
                  response_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - code
                        - token
                  response_modes_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - query
                  grant_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - authorization_code
                        - refresh_token
                  subject_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - public
                  scopes_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - openid
                        - profile
                        - email
                        - address
                        - phone
                  token_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - client_secret_basic
                        - none
                  claims_supported:
                    type: array
                    items:
                      type: string
                  code_challenge_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - S256
                  introspection_endpoint:
                    type: string
                  introspection_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                    enum:
                        - client_secret_basic
                        - none
                  revocation_endpoint:
                    type: string
                  revocation_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                    enum:
                        - client_secret_basic
                        - none
                  end_session_endpoint:
                    type: string
                  request_parameter_supported:
                    type: boolean
  /.well-known/openid-configuration:
    get:
      tags:
        - Server Metadata
      summary: OpenID Connect metadata for the server.
      responses:
        '200':
          description: Success
          content:
            'application/json':
              schema:
                type: object
                properties:
                  issuer:
                    type: string
                  authorization_endpoint:
                    type: string
                  token_endpoint:
                    type: string
                  registration_endpoint:
                    type: string
                  jwks_uri:
                    type: string
                  response_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - code
                        - token
                  response_modes_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - query
                  grant_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - authorization_code
                        - refresh_token
                  subject_types_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - public
                  scopes_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - openid
                        - profile
                        - email
                        - address
                        - phone
                  token_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - client_secret_basic
                        - none
                  claims_supported:
                    type: array
                    items:
                      type: string
                  code_challenge_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - S256
                  introspection_endpoint:
                    type: string
                  introspection_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - client_secret_basic
                        - none
                  revocation_endpoint:
                    type: string
                  revocation_endpoint_auth_methods_supported:
                    type: array
                    items:
                      type: string
                      enum:
                        - client_secret_basic
                        - none
                  end_session_endpoint:
                    type: string
                  request_parameter_supported:
                    type: boolean
components:
  securitySchemes:
    user_auth:
      type: http
      scheme: bearer
    client_auth:
      type: http
      scheme: basic
